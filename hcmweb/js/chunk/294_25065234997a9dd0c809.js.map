{"version":3,"sources":["webpack:///./app/widget/index/Dealers/ApprovalQuery/main.js"],"names":["APPROVAL_STATUS","all","wait_approval","expired_approval","already_approval","activiting","activited","ApprovalQuery","props","handlePageChange","page","setState","pagination","Object","assign","state","pageNo","getActivityList","status","currentStatus","handleClearIconClick","form","resetFields","fieldName","handleSearchSubmit","e","preventDefault","validateFields","err","values","search","getApprovalStatusNum","start_time","time","length","format","end_time","searchCondition","handleTabChange","pageSize","activeKey","data","keys","goTo","history","push","pathname","path","formatTime","timestamp","showTime","date","Date","str","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","FORMAT_TIME","type","params","shop_name","campaign_name","method","url","then","cacheListObj","res","message","content","pageNumber","totalElements","totalPages","catch","error","statusNum","React","Component","create"],"mappings":"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","file":"js/chunk/294_25065234997a9dd0c809.js","sourcesContent":["import Tpl from './tpl'\r\nimport { Form, message as Msg } from 'antd'\r\nimport axios from '../../../../js/common/ajax'\r\n\r\nconst APPROVAL_STATUS = {\r\n  all: 1,               // 全部状态\r\n  wait_approval: 2,     // 待审核状态\r\n  expired_approval: 3,  // 审核已过期状态\r\n  already_approval: 4,  // 已审核状态\r\n  activiting: 5,        // 活动进行中\r\n  activited: 6          // 活动已完成\r\n}\r\nclass ApprovalQuery extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      statusNum: {},   // 各个状态的数量\r\n      cacheListObj: {},  // 缓存列表对象，包含每个状态对应的列表\r\n      currentStatus: \"1\",\r\n      pagination: {\r\n        pageNo: 1,\r\n        pageSize: 10\r\n      },\r\n      searchCondition: {}\r\n    }\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.getApprovalStatusNum()\r\n    this.getActivityList({\r\n      status: APPROVAL_STATUS.all\r\n    })\r\n  }\r\n\r\n  handlePageChange = (page) => {\r\n    this.setState({\r\n      pagination: Object.assign({}, this.state.pagination, {\r\n        pageNo: page\r\n      })\r\n    }, () => {\r\n      this.getActivityList({\r\n        status: this.state.currentStatus\r\n      })\r\n    })\r\n  }\r\n\r\n  handleClearIconClick = fieldName => {\r\n    this.props.form.resetFields([fieldName])\r\n  }\r\n\r\n  handleSearchSubmit = e => {\r\n    e.preventDefault()\r\n    // const { currentStatus } = this.state\r\n    this.props.form.validateFields((err, values) => {\r\n      this.getActivityList({\r\n        status: \"1\",\r\n        search: {\r\n          ...values\r\n        }\r\n      })\r\n      this.getApprovalStatusNum({\r\n        ...values,\r\n        start_time: values.time.length !== 0 ? values.time[0].format('YYYY-MM-DD HH:mm:ss') : '',\r\n        end_time: values.time.length !== 0 ? values.time[1].format('YYYY-MM-DD HH:mm:ss') : ''\r\n      })\r\n      this.setState({\r\n        searchCondition: Object.assign({}, values),\r\n        currentStatus: \"1\"\r\n      })\r\n    })\r\n  }\r\n\r\n  handleTabChange = activeKey => {\r\n    this.setState({\r\n      pagination: Object.assign({}, this.state.pagination, {\r\n        pageNo: 1,\r\n        pageSize: 10\r\n      }),\r\n      currentStatus: activeKey\r\n    }, () => {\r\n      const { searchCondition } = this.state\r\n      let data = {\r\n        status: activeKey\r\n      }\r\n      if (Object.keys(searchCondition).length !== 0) {\r\n        data.search = Object.assign({}, searchCondition)\r\n      }\r\n      this.getActivityList(data)\r\n    })\r\n  }\r\n\r\n  goTo = path => {\r\n    this.props.history.push({\r\n      pathname: path\r\n    })\r\n  }\r\n\r\n  formatTime = (timestamp, showTime = false) => {\r\n    const date = new Date(timestamp)\r\n    let str = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\r\n    if (showTime) {\r\n        str += ` ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`\r\n    }\r\n    return str;\r\n  }\r\n\r\n  // 获取活动列表\r\n  getActivityList = params => {\r\n    const FORMAT_TIME = 'YYYY-MM-DD HH:mm:ss'\r\n    const { pagination } = this.state\r\n    let data = {\r\n      type: params.status,\r\n      pageNo: pagination.pageNo,\r\n      pageSize: pagination.pageSize\r\n    }\r\n    if (params.search) {\r\n      const { shop_name, campaign_name, time: [start_time, end_time] } = params.search\r\n      data.shop_name = shop_name\r\n      data.campaign_name = campaign_name\r\n      data.start_time = !!start_time ? start_time.format(FORMAT_TIME) : ''\r\n      data.end_time =  !!end_time ? end_time.format(FORMAT_TIME) : ''\r\n    }\r\n    axios({\r\n      method: 'post',\r\n      url: '/hcm/campgign/List',\r\n      data\r\n    }).then(res => {\r\n      const { cacheListObj, pagination } = this.state\r\n      const { data, status, message } = res.data\r\n      if (status === '10000') {\r\n        this.setState({\r\n          cacheListObj: Object.assign({}, cacheListObj, {\r\n            [params.status]: data.content\r\n          }),\r\n          currentStatus: params.status,\r\n          pagination: Object.assign({}, pagination, {\r\n            pageNo: data.pageNumber,\r\n            pageSize: data.pageSize,\r\n            totalElements: data.totalElements,\r\n            totalPages: data.totalPages\r\n          })\r\n        })\r\n      }\r\n    }).catch(err => {\r\n      Msg.error('系统繁忙，稍后再试！')\r\n    })\r\n  }\r\n\r\n  // 获取每个状态的数量\r\n  getApprovalStatusNum = (params = {}) => {\r\n    axios({\r\n      method: 'post',\r\n      url: '/hcm/campgign/ListCount',\r\n      data: {\r\n        // dealer_id: 15\r\n        ...params\r\n      }\r\n    }).then(res => {\r\n      this.setState({\r\n        statusNum: res.data.data\r\n      })\r\n    }).catch(err => {\r\n      Msg.error('网络繁忙，稍后再试！')\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return <Tpl that={this} />\r\n  }\r\n}\r\n\r\nexport default Form.create()(ApprovalQuery)"],"sourceRoot":""}