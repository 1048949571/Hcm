{"version":3,"sources":["webpack:///./app/widget/index/AddKeywordMonitor/main.js"],"names":["PLATFORM_MAP","App","props","handleSelectFocus","form","getFieldValue","validateFields","monitorTime","state","err","values","num","parseInt","monitorRate","length","setState","isDisabledMonitorTime","handleSelectTimeChange","value","handleInputChange","key","index","e","list","JSON","parse","stringify","keywordList","target","warning","isNaN","Number","handleDeleteKeyword","splice","handleAddKeyword","push","_id","checkKeyword","every","v","name","handleSubmit","preventDefault","keywords","data","platform","can","find","dictCode","dictName","platform_code","key_range","monitorRange","frequency","key_times","join","keywordModelList","map","Object","assign","fielda","fieldb","LoadingModal","bl","method","url","transformRequest","headers","then","res","status","message","success","resetFields","error","catch","handleReset","history","React","Component","create"],"mappings":"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","file":"js/chunk/208_17a5e9320fa99d90582a.js","sourcesContent":["import Tpl from './tpl'\r\n// import { LoadingModal } from '../../components/LoadingModal/LoadingModal'\r\nimport axios from '../../../js/common/ajax'\r\nimport { Form, message as Msg } from 'antd'\r\n\r\nconst PLATFORM_MAP = {\r\n  'taobao': '淘宝天猫',\r\n}\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      keywordList: [{_id: 0}],\r\n      monitorTime: [],\r\n      isDisabledMonitorTime: false,\r\n    }\r\n  }\r\n  handleSelectFocus = e => {\r\n    const { getFieldValue, validateFields } = this.props.form\r\n    const { monitorTime } = this.state\r\n    validateFields(['monitorRate'], (err, values) => {\r\n      if (!err) {\r\n        const num = parseInt(values.monitorRate, 10)\r\n        // console.log(monitorTime.length >= num)\r\n        if (monitorTime.length > num || monitorTime.length == num) {\r\n          // Msg.warning(`只能选择${num}个时间!`)\r\n          this.setState({\r\n            isDisabledMonitorTime: true\r\n          })\r\n        } else {\r\n          this.setState({\r\n            isDisabledMonitorTime: false\r\n          })\r\n        }\r\n      } else {\r\n        this.setState({\r\n          isDisabledMonitorTime: true\r\n        })\r\n      }\r\n    })\r\n  }\r\n  handleSelectTimeChange = value => {\r\n    const { getFieldValue, validateFields } = this.props.form\r\n    validateFields(['monitorRate'], (err, values) => {\r\n      if (!err) {\r\n        const num = parseInt(values.monitorRate, 10)\r\n        if (value.length >= num) {\r\n          this.setState({\r\n            isDisabledMonitorTime: true\r\n          })\r\n        } else {\r\n          this.setState({\r\n            isDisabledMonitorTime: false\r\n          })\r\n        }\r\n        this.setState({\r\n          monitorTime: [...value],\r\n        })\r\n      }\r\n    })\r\n  }\r\n  handleInputChange = (key, index, e) => {\r\n    const list = JSON.parse(JSON.stringify(this.state.keywordList))\r\n    if (key === 'name') {\r\n      if (e.target.value.length > 50) {\r\n        Msg.warning('超出50个字符限制！')\r\n        return\r\n      }\r\n    }\r\n    if (key === 'value') {\r\n      if (isNaN(Number(e))) {\r\n        Msg.warning('请输入数字！')\r\n        return\r\n      }\r\n    }\r\n    list[index][key] = key === 'value' ? e : e.target.value\r\n    this.setState({\r\n      keywordList: list\r\n    })\r\n  }\r\n  handleDeleteKeyword = index => {\r\n    const list = JSON.parse(JSON.stringify(this.state.keywordList))\r\n    if (list.length === 1) {\r\n      Msg.warning('请至少保留一个关键字！')\r\n      return\r\n    }\r\n    list.splice(index, 1)\r\n    this.setState({\r\n      keywordList: list\r\n    })\r\n  }\r\n  handleAddKeyword = () => {\r\n    const list = JSON.parse(JSON.stringify(this.state.keywordList))\r\n    list.push({_id: list[list.length-1]._id+1})\r\n    this.setState({\r\n      keywordList: list\r\n    })\r\n  }\r\n  checkKeyword = () => {\r\n    return this.state.keywordList.every(v => !!v.name && !!v.value)\r\n  }\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    this.props.form.validateFields((err, values) => {\r\n\r\n      if (!err) {\r\n        if (!this.checkKeyword()) {\r\n          Msg.warning('请完善关键字信息！')\r\n          return\r\n        }\r\n        // console.log(values, this.state.keywordList)\r\n        const keywords = this.state.keywordList\r\n        if (values.monitorTime.length !== parseInt(values.monitorRate, 10)) {\r\n          Msg.warning(`必须选择${values.monitorRate}个时间!`)\r\n          return\r\n        }\r\n        // let platform_name = ''\r\n        // try {\r\n        //   platform_name = can.platform.find(v => v.dictCode === values.platform).dictName\r\n        // } catch (error) {\r\n        //   Msg.error('获取平台名称出错！')\r\n        // }\r\n        const data = {\r\n          platform: can.platform.find(v => v.dictCode === values.platform).dictName,\r\n          platform_code: values.platform,\r\n          key_range: values.monitorRange,\r\n          frequency: values.monitorRate,\r\n          key_times: values.monitorTime.join(','),\r\n          keywordModelList: keywords.map(v => Object.assign({}, {fielda: v.name, fieldb: v.value}))\r\n        }\r\n        // console.log('uu',data)\r\n        // return\r\n        LoadingModal({bl:true})\r\n        axios({\r\n          method: 'post',\r\n          url: '/hcm/keyword/add',\r\n          transformRequest: [function (data, headers) {\r\n            return data;\r\n          }],\r\n          headers: {\r\n            'Content-Type': 'application/json;charset=utf-8'\r\n          },\r\n          data: JSON.stringify(data)\r\n        }).then(res => {\r\n          LoadingModal({bl:false})\r\n          // console.log(res)\r\n          const { data,status,message } = res.data\r\n          if (status === '10000') {\r\n            Msg.success(message)\r\n            this.props.form.resetFields()\r\n            this.setState({\r\n              keywordList: [{_id:0}],\r\n              isDisabledMonitorTime: false,\r\n              monitorTime: [],\r\n            })\r\n          } else {\r\n            Msg.error(message)\r\n          }\r\n        }).catch(err => {\r\n          LoadingModal({bl:false})\r\n          Msg.error('系统繁忙，请稍后再试！')\r\n        })\r\n      }\r\n    })\r\n  }\r\n  handleReset = () => {\r\n    // this.props.form.resetFields()\r\n    this.props.history.push('/keywordMonitor')\r\n  }\r\n  render() {\r\n    return <Tpl that={this} />\r\n  }\r\n}\r\n\r\nexport default Form.create()(App)"],"sourceRoot":""}