{"version":3,"sources":["webpack:///./app/widget/index/Brand/CustomerOverview/main.js"],"names":["CustomerOverview","props","handlePlatformChange","setState","platform_code","value","getBrainData","platformcode","noFirst","getShopInPlatformPercent","ajax","get","then","res","data","status","message","shopInPlatformData","shopsGroupPing","shopLoyalRank","markPrenctList","shopProductsRank","goodsList","orderExceptionRank","lowpriceList","salesRank","salesList","error","catch","params","brainData","ChartTree","current","inChart","getDepartmentData","departmentTree","generateList","tree","forEach","state","departmentList","push","name","v","id","expandedKeys","children","length","handleExpand","autoExpandParent","getParentKey","key","parentKey","i","node","some","item","getPlatformList","platformList","can","platform","searchDepartment","e","arr","map","indexOf","filter","self","searchValue","currentSelectedKeys","getChinaCodeTree","chinaCodeTree","handleTabChange","tabKey","React","createRef","Component"],"mappings":"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","file":"js/chunk/252_110e7542614fcb9da205.js","sourcesContent":["import Tpl from './tpl';\r\nimport ajax from '../../../../js/common/ajax';\r\nimport { message as Msg } from 'antd'\r\n\r\nclass CustomerOverview extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.ChartTree = React.createRef();\r\n        this.state = {\r\n            platform_code: '',\r\n            tabKey: 'shop',\r\n            platformList: [],\r\n            shopInPlatformData: [],\r\n            shopLoyalRank: [],\r\n            shopProductsRank: [],\r\n            salesRank: [],\r\n            orderExceptionRank: [],\r\n            \r\n            chinaCodeTree: [],\r\n            brainData: {},\r\n            departmentTree: [], // 嵌套数据\r\n            departmentList: [], // 平行数据\r\n            searchValue: '',\r\n            expandedKeys: [],\r\n            autoExpandParent: true,\r\n            currentSelectedKeys: [],\r\n        }\r\n    }\r\n\r\n    componentWillMount() {\r\n        this.getPlatformList()\r\n        this.getShopInPlatformPercent()\r\n\r\n        this.getChinaCodeTree()\r\n        this.getDepartmentData()\r\n        this.getBrainData({platformcode: this.state.platform_code})\r\n    }\r\n    // 切换平台\r\n    handlePlatformChange = value => {\r\n        this.setState({\r\n            platform_code: value,\r\n        })\r\n        this.getBrainData({platformcode: value, noFirst: true,})\r\n    }\r\n    // 获取店铺所在平台占比数据\r\n    getShopInPlatformPercent = () => {\r\n        ajax.get('/hcm/hcmShop/getHcmShopProportionByPlatform').then(res => {\r\n            const { data, status, message } = res.data\r\n            if (status === '10000') {\r\n                this.setState({\r\n                    shopInPlatformData: data.shopsGroupPing,\r\n                    shopLoyalRank: data.markPrenctList,\r\n                    shopProductsRank: data.goodsList,\r\n                    orderExceptionRank: data.lowpriceList,\r\n                    salesRank: data.salesList,\r\n                })\r\n            } else {\r\n                Msg.error(message)\r\n            }\r\n        }).catch(err => {\r\n            Msg.error('系统繁忙，请稍后再试！')\r\n        })\r\n    }\r\n    // 获取脑图数据\r\n    getBrainData = (params) => {\r\n        ajax.get('/hcm/hcmShop/getDealerShopByPlatform', {params}).then(res => {\r\n            const { data, status, message } = res.data\r\n            if (status === '10000') {\r\n                this.setState({\r\n                    brainData: data,\r\n                }, () => {\r\n                    params.noFirst && this.ChartTree.current.inChart()\r\n                })\r\n            } else {\r\n                Msg.error(message)\r\n            }\r\n        }).catch(err => {\r\n            Msg.error('系统繁忙，请稍后再试！')\r\n        })\r\n    }\r\n    // 获取部门结构数据\r\n    getDepartmentData = () => {\r\n        ajax.get('/hcm/department/getTree').then(res => {\r\n            // console.log('---res', res)\r\n            const { data, status, message } = res.data\r\n            if (status === '10000') {\r\n                this.setState({\r\n                    departmentTree: data\r\n                })\r\n                this.generateList(data)\r\n            } else {\r\n                Msg.error(message)\r\n            }\r\n        }).catch(err => {\r\n            Msg.error('系统繁忙，请稍后再试！')\r\n        })\r\n    }\r\n    generateList = (tree) => {\r\n        tree.forEach(v => {\r\n            this.state.departmentList.push({name: v.name, id: v.id})\r\n            this.state.expandedKeys.push(v.id)\r\n            if (v.children && v.children.length) {\r\n                this.generateList(v.children)\r\n            }\r\n        })\r\n\r\n    }\r\n    handleExpand = expandedKeys => {\r\n        this.setState({\r\n            expandedKeys,\r\n            autoExpandParent: false,\r\n        })\r\n    }\r\n    getParentKey = (key, tree) => {\r\n        let parentKey;\r\n        for (let i = 0; i < tree.length; i++) {\r\n            const node = tree[i];\r\n            if (node.children && node.children.length) {\r\n                if (node.children.some(item => item.id === key)) {\r\n                    parentKey = node.id;\r\n                } else if (this.getParentKey(key, node.children)) {\r\n                    parentKey = this.getParentKey(key, node.children);\r\n                }\r\n            }\r\n        }\r\n        return parentKey;\r\n    }\r\n    // 获取平台数据\r\n    getPlatformList = () => {\r\n        // ajax.get('/hcm/sys/GetList', {\r\n        //     params: {\r\n        //         dictcode: 'platform'\r\n        //     }\r\n        // }).then(res => {\r\n        //     const { data, status, message } = res.data\r\n        //     if (status === '10000') {\r\n                this.setState({\r\n                    platformList: can.platform||[],\r\n                })\r\n        //     } else {\r\n        //         Msg.error(message)\r\n        //     }\r\n        // }).catch(err => {\r\n        //     Msg.error('系统繁忙，请稍后再试！')\r\n        // })\r\n    }\r\n    // 品牌部门搜索\r\n    searchDepartment = (value, e) => {\r\n        const { departmentList, departmentTree } = this.state\r\n        let arr = []\r\n        const expandedKeys = departmentList.map(v => {\r\n            if (value !== '' && v.name.indexOf(value) > -1) {\r\n                arr.push(v.id)\r\n                return this.getParentKey(v.id, departmentTree)\r\n            }\r\n            return null\r\n        }).filter((item, i, self) => item && self.indexOf(item) === i)\r\n        this.setState({\r\n            expandedKeys,\r\n            searchValue: value,\r\n            autoExpandParent: true,\r\n            currentSelectedKeys: arr,\r\n        });\r\n    }\r\n    // 获取大区数据\r\n    getChinaCodeTree = () => {\r\n        ajax.get('/hcm/chinaCode/getChinaCodeTree').then(res => {\r\n            this.setState({\r\n                chinaCodeTree: res.data\r\n            })\r\n        }).catch(err => {\r\n            Msg.error('系统繁忙，请稍后再试！')\r\n        })\r\n    }\r\n\r\n    handleTabChange = key => {\r\n        this.setState({\r\n            tabKey: key,\r\n        })\r\n    }\r\n    \r\n\r\n    render() {\r\n        return <Tpl that={this} />\r\n    }\r\n}\r\nexport default CustomerOverview"],"sourceRoot":""}