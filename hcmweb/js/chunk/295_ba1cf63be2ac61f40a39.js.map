{"version":3,"sources":["webpack:///./app/widget/index/Dealers/BrandActivityPublicity/main.js"],"names":["PARAMS_CONST","product","shop","BrandActivityPublicity","currentBrand","state","dealer","props","getShopBtnList","method","url","data","campaign_node","type","params","ser_day","date","then","res","status","message","setState","shopBtnList","catch","getActivityList","pageNum","pageSize","shop_id","undefined","activityInfoList","list","pagination","Object","assign","count","formatTime","timestamp","showTime","Date","str","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","getBrandSevenActivity","activityList","console","log","err","togglePrice","togglePriceIndex","index","moreButton","switchShopBtn","shopId","currentShopBtn","currentDate","format","switchActivity","sevenActivity","sevenProductInfo","selectedIndex","handleLoadMore","React","Component"],"mappings":"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","file":"js/chunk/295_ba1cf63be2ac61f40a39.js","sourcesContent":["import { connect } from 'react-redux'\r\nimport Tpl from './tpl'\r\nimport axios from '../../../../js/common/ajax'\r\nimport moment from 'moment'\r\n\r\nconst PARAMS_CONST = {\r\n    product: 'product',\r\n    shop: 'shop'\r\n}\r\n\r\n@connect(state => ({\r\n    currentBrand: state.dealer.currentBrand\r\n}))\r\nclass BrandActivityPublicity extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            selectedIndex: 0,   // 选中的日期下标\r\n            moreButton: false,  // 更多店铺按钮状态\r\n            togglePriceIndex: -1,   // 价格区域显隐状态\r\n            activityList: [],   // 活动日期列表（一周）\r\n            // sevenActivity: {},  // 缓存每日活动店铺对象信息\r\n            // sevenProductInfo: {}, // 缓存每日活动产品对象信息\r\n            // productInfoList: [],    // 当前产品信息对象列表\r\n            currentDate: moment().format('YYYY-MM-DD'),    // 当前选中日期\r\n            currentShopBtn: 'all',   // 当前选中按钮\r\n            shopBtnList: [],\r\n            pagination: {\r\n                pageNum: 1,\r\n                pageSize: 10\r\n            },\r\n            activityInfoList: []\r\n        }\r\n    }\r\n    componentWillMount() {\r\n        this.getBrandSevenActivity()\r\n        this.getShopBtnList({\r\n            type: 1,\r\n            date: moment().format('YYYY-MM-DD')\r\n        })\r\n        this.getActivityList({\r\n            type: 1,\r\n            date: moment().format('YYYY-MM-DD'),\r\n            ...this.state.pagination\r\n        })\r\n        // this.switchActivity(this.formatTime(Date.now()), 0, 1)\r\n    }\r\n    // 获取店铺列表\r\n    getShopBtnList = params => {\r\n        axios({\r\n            method: 'post',\r\n            url: '/hcm/campgign/PublicShops',\r\n            data: {\r\n                campaign_node: '已审核',\r\n                type: params.type,\r\n                ser_day: params.date\r\n            }\r\n        }).then(res => {\r\n            const { data, status, message } = res.data\r\n            if (status === '10000') {\r\n                this.setState({\r\n                    shopBtnList: data,\r\n                    // currentDate: params.date\r\n                })\r\n            }\r\n        }).catch()\r\n    }\r\n    // 获取活动列表\r\n    getActivityList = params => {\r\n        let data = {\r\n            campaign_node: '已审核',\r\n            type: params.type,\r\n            ser_day: params.date,\r\n            pageNum: params.pageNum,\r\n            pageSize: params.pageSize\r\n        }\r\n        if (params.shop_id !== undefined && params.shop_id !== 'all') {\r\n            // shop_id入参格式 'id','id','id'...\r\n            data.shop_id = `'${params.shop_id}'`\r\n        }\r\n        axios({\r\n            method: 'post',\r\n            url: '/hcm/campgign/ScheduleBMC',\r\n            data\r\n        }).then(res => {\r\n            const { data, status, message } = res.data\r\n            if (status === '10000') {\r\n                this.setState({\r\n                    activityInfoList: data.list,\r\n                    pagination: Object.assign({}, this.state.pagination, {count: data.count})\r\n                })\r\n            }\r\n        }).catch()\r\n    }\r\n    formatTime = (timestamp, showTime = false) => {\r\n        const date = new Date(timestamp)\r\n        let str = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\r\n        if (showTime) {\r\n            str += ` ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`\r\n        }\r\n        return str;\r\n    }\r\n    // 获取当天活动信息\r\n    // params: {type(区分当日(1)和当日以后(2)), url, bmcId, date(日期), flag(区分店铺(shop)和产品(product))}\r\n    // getCurrentDateInfo = params => {\r\n    //     let data = {\r\n    //         bmcid: params.bmcId,\r\n    //         campaign_node: '已审核',\r\n    //         type: params.type,\r\n    //         ser_day: params.date,\r\n    //         pageNum: 1,\r\n    //         pageSize: 1\r\n    //     }\r\n    //     if (params.flag === PARAMS_CONST.shop) {\r\n    //         data.shop_id = params.shop_id\r\n    //     }\r\n    //     axios({\r\n    //         method: 'post',\r\n    //         url: params.url,\r\n    //         data: data\r\n    //     }).then(res => {\r\n    //         const { sevenActivity, sevenProductInfo } = this.state\r\n    //         if (params.flag === PARAMS_CONST.product) {\r\n    //             this.setState({\r\n    //                 sevenProductInfo: Object.assign({}, sevenProductInfo, {\r\n    //                     [params.date]: res.data.data\r\n    //                 }),\r\n    //                 productInfoList: res.data.data\r\n    //             })\r\n    //         } else if (params.flag === PARAMS_CONST.shop) {\r\n    //             this.setState({\r\n    //                 sevenActivity: Object.assign({}, sevenActivity, {\r\n    //                     [params.date]: res.data.data\r\n    //                 })\r\n    //             })\r\n    //         }\r\n    //     }).catch(err => {\r\n    //         console.log('----publicshop', err)\r\n    //     })\r\n    // }\r\n    // 获取7日活动信息\r\n    getBrandSevenActivity = () => {\r\n        axios({\r\n            method: 'post',\r\n            url: '/hcm/campgign/ScheduleBMCSeven'\r\n        }).then(res => {\r\n            this.setState({\r\n                activityList: res.data.data\r\n            })\r\n        }).catch(err => {\r\n            console.log('-----brandseven', err)\r\n        })\r\n    }\r\n    togglePrice = index => {\r\n        this.setState({\r\n            togglePriceIndex: this.state.togglePriceIndex === index ? -1 : index\r\n        })\r\n    }\r\n    moreButton = () => {\r\n        this.setState({\r\n            moreButton: !this.state.moreButton\r\n        })\r\n    }\r\n    // 切换店铺按钮\r\n    switchShopBtn = (shopId, list) => {\r\n        // const array = shopId === 'all' ? list : list.filter(v => v.shop_id == shopId)\r\n        this.setState({\r\n            currentShopBtn: shopId,\r\n        //     activityInfoList: []\r\n        })\r\n        const { currentDate, pagination } = this.state\r\n        this.getActivityList({\r\n            type: moment().format('YYYY-MM-DD') === currentDate ? 1 : 2,\r\n            date: currentDate,\r\n            shop_id: shopId,\r\n            ...pagination\r\n        })\r\n    }\r\n    // 切换日期对应的数据\r\n    switchActivity = (date, index, type) => {\r\n        const { sevenActivity, sevenProductInfo } = this.state\r\n        this.setState({\r\n            selectedIndex: index,\r\n            currentDate: date,\r\n            currentShopBtn: 'all',\r\n            togglePriceIndex: -1,\r\n            // productInfoList: sevenProductInfo[date] ? [...sevenProductInfo[date]] : []\r\n        })\r\n        this.getShopBtnList({\r\n            type,\r\n            date\r\n        })\r\n        this.getActivityList({\r\n            type,\r\n            date,\r\n            ...this.state.pagination\r\n        })\r\n        // !sevenActivity[date] && this.getCurrentDateInfo({\r\n        //     type,\r\n        //     date,\r\n        //     url: '/hcm/campgign/PublicShops',\r\n        //     flag: PARAMS_CONST.shop,\r\n        //     shop_id: null\r\n        // })\r\n        // !sevenProductInfo[date] && this.getCurrentDateInfo({\r\n        //     type,\r\n        //     date,\r\n        //     url: '/hcm/campgign/ScheduleBMC',\r\n        //     flag: PARAMS_CONST.product\r\n        // })\r\n    }\r\n    // 加载更多按钮\r\n    handleLoadMore = () => {\r\n        // console.log(123)\r\n        this.setState({\r\n            pagination: Object.assign({}, this.state.pagination, {\r\n                pageNum: this.state.pagination.pageNum+1\r\n            })\r\n        }, () => {\r\n            const { currentDate, currentShopBtn, pagination } = this.state\r\n            let data = {\r\n                type: moment().format('YYYY-MM-DD') === currentDate ? 1 : 2,\r\n                date: currentDate,\r\n                ...pagination\r\n            }\r\n            if (currentShopBtn !== 'all') {\r\n                data.shop_id = currentShopBtn\r\n            }\r\n            this.getActivityList(data)\r\n        })\r\n    }\r\n    render() {\r\n        return <Tpl that={this}/>\r\n    }\r\n}\r\n\r\nexport default BrandActivityPublicity"],"sourceRoot":""}